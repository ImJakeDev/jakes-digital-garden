#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo 'ğŸ—ï¸ğŸ‘· Running pre-commit checks: styling, linting, type-checking, and building...'

# Helper function for error messages
error_message() {
  echo "$1"
  false
}

# Run all checks in parallel and store their exit codes
pnpm check:format & PID1=$!
pnpm check:styles & PID2=$!
pnpm check:lint & PID3=$!
pnpm check:types & PID4=$!

# Wait for all processes to complete
wait $PID1 || error_message 'ğŸ¤¢ğŸ¤®ğŸ¤¢ğŸ¤® Its F**KING RAW - Your styling looks disgusting. ğŸ¤¢ğŸ¤®ğŸ¤¢ğŸ¤®
Prettier Check Failed. Run pnpm format, add changes, and try to commit again.'

wait $PID2 || error_message 'ğŸš¨ğŸ’…ğŸš¨ Stylelint Check Failed ğŸš¨ğŸ’…ğŸš¨
Your CSS/SCSS/TSX styling needs attention. Run pnpm check:stylelint, fix the issues, add changes, and try to commit again.'

wait $PID3 || error_message 'ğŸ˜¤ğŸ€ğŸ‘‹ğŸ˜¤ Get that weak s**t out of here! ğŸ˜¤ğŸ€ğŸ‘‹ğŸ˜¤ 
ESLint Check Failed. Fix the issues, add changes, and try to commit again.'

wait $PID4 || error_message 'ğŸ¤¡ğŸ˜‚âŒğŸ¤¡ Failed Type check. ğŸ¤¡ğŸ˜‚âŒğŸ¤¡
Are you seriously trying to write that? Make the changes required above.'

echo 'âœ… All checks passed. Building...'

# Run build
pnpm build || error_message 'âŒ Build failed. Please fix the issues and try again.'

echo 'âœ… All checks passed. Committing...'